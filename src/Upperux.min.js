"use strict";!function(t){function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];this.state=t,this.ons=[],this.mdd=[],this.actions={},this.action(n)}n.prototype={action:function(t,n){var e=this;return"object"==typeof t?Object.keys(t).map(function(n){return e.action(n,t[n])}):this.actions[t]=n,this},middleware:function(t){this.mdd=this.mdd.concat(t)},toPromise:function(t){return t instanceof Promise?t:Promise.resolve(t)},cycle:function(t,n,e){var i=this;return t.then(function(t){var o=n.shift();return o?o(t,e,function(t,e){return i.cycle(i.toPromise(t),n.slice(),e)}):void 0})},emit:function(t){var n=this;return new Promise(function(e,i){var o=t.type,s=n.mdd.concat(function(t,e){return n.actions[e.type]?n.actions[e.type](t,e):n.actions["default"]?n.actions["default"](t,e):t}),r=n.cycle(n.toPromise(n.state),s,t);r.then(function(t){n.state=t,n.ons=n.ons.filter(function(n){try{return!n(t,o)}catch(e){}}),e(t)}),r["catch"](i)})},get:function(t){return t&&!/[\(\)\`\s\t\n]+/.test(t)?(t=t.replace(/^(\w)/,function(t){return"."+t}),new Function("try{return this"+t+"}catch(e){return;}").call(this.state)):this.state},off:function(t){var n=this.ons.indexOf(t);return n>-1&&this.onts.splice(n,1),this},on:function(t){return t&&this.ons.push(t),this}},"undefined"!=typeof module&&module.exports?module.exports=n:t.Upperux=n}(this);