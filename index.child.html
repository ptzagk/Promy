<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Upperux</title>
</head>
<body>
    <h1 id="view-total">
        0
    </h1>
    <button onclick="store.dispatch({type:'ADD',value:5})">
        Sumar 5
    </button>
    <button onclick="store.dispatch({type:'RES',value:5})">
        Restar 5
    </button>
    <script src="src/Upperux.js"></script>
    <script>
        
        var store = new Upperux({count:0});
        var child = new Upperux({recer:0});
        var baby  = new Upperux({start:0});
        
        store.middleware([
            (store,action,next)=>{
                console.log(JSON.stringify(store))
                return next(store,action).then((store)=>{
                    console.log(JSON.stringify(store));
                    return store;
                })
            }
        ])
        
        baby.middleware([
            (store,action,next)=>{
                return next(store,action);
            }
        ])
        
        
        child.action({
            ADD(state,{value}){
                return new Promise((resolve)=>{
                    setTimeout(()=>{
                        resolve({racer:value});
                    },1000)
                })
            }
        })
        
        baby.action({
            ADD(state,{value}){
                return new Promise((resolve)=>{
                    setTimeout(()=>{
                        resolve({start:value});
                    },1000)
                })
            }
        })
        
        store.action({
            ADD(state,{value}){
                state.count = state.count + value;
                return state;
            }
        })
             
        store.child('stadistic',child);
        child.child('metric',baby);
        
        store.dispatch({
            type  : 'ADD',
            value : 1000
        })
        
        setTimeout(()=>{
            baby.dispatch({
                type:'ADD',
                value:666
            })
        },2000)
        
        var out;
        
        store.subscribe((state)=>{
            if(!out){
                out = true;
            }else{
                console.log(JSON.stringify(state))
            }
        })
        
    </script>
</body>
</html>
